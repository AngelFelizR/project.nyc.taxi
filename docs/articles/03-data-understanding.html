<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="project.nyc.taxi">
<title>03 - Data Understanding â€¢ project.nyc.taxi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="03 - Data Understanding">
<meta property="og:description" content="project.nyc.taxi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">project.nyc.taxi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.99</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-data-collection-process.html">01 - Data Collection Process</a>
    <a class="dropdown-item" href="../articles/02-business-understanding.html">02 - Business Understanding</a>
    <a class="dropdown-item" href="../articles/03-data-understanding.html">03 - Data Understanding</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AngelFelizR/project.nyc.taxi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>03 - Data Understanding</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AngelFelizR/project.nyc.taxi/blob/HEAD/vignettes/03-data-understanding.Rmd" class="external-link"><code>vignettes/03-data-understanding.Rmd</code></a></small>
      <div class="d-none name"><code>03-data-understanding.Rmd</code></div>
    </div>

    
    
<p>After completing the <a href="https://angelfelizr.github.io/project.nyc.taxi/articles/02-business-understanding.html">business
understanding</a> phase we are ready to perform the <strong>data
understanding</strong> phase by performing an EDA with the following
steps:</p>
<ol style="list-style-type: decimal">
<li>Exploring the individual distribution of variables.</li>
<li>Taking a subset of the data to fit in RAM.</li>
<li>Exploring correlations between predictors and target variable.</li>
<li>Exploring correlations between predictors.</li>
</ol>
<p>In order to:</p>
<ul>
<li>Ensure data quality</li>
<li>Identify key predictors</li>
<li>Detect multicollinearity</li>
<li>Guide model choice and feature engineering</li>
</ul>
<div class="section level2">
<h2 id="setting-the-environment-up">Setting the environment up<a class="anchor" aria-label="anchor" href="#setting-the-environment-up"></a>
</h2>
<p>To setting the <code>R</code> environment up we just need to apply
the following 4 steps:</p>
<ol style="list-style-type: decimal">
<li>Loading the packages to use.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://angelfelizr.github.io/project.nyc.taxi/">project.nyc.taxi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>datatable.print.nrows <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Creating an Arrow connection object to perform some
<strong>manipulations in disk</strong> before taking the data into the
RAM memory.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"raw-data/trip-data/year=2022"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NycTrips2022</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">NycTrips2022</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "212,416,083" "25"</span></span>
<span></span>
<span><span class="va">NycTrips2022</span></span>
<span><span class="co">#&gt; FileSystemDataset with 12 Parquet files</span></span>
<span><span class="co">#&gt; hvfhs_license_num: string</span></span>
<span><span class="co">#&gt; dispatching_base_num: string</span></span>
<span><span class="co">#&gt; originating_base_num: string</span></span>
<span><span class="co">#&gt; request_datetime: timestamp[us]</span></span>
<span><span class="co">#&gt; on_scene_datetime: timestamp[us]</span></span>
<span><span class="co">#&gt; pickup_datetime: timestamp[us]</span></span>
<span><span class="co">#&gt; dropoff_datetime: timestamp[us]</span></span>
<span><span class="co">#&gt; PULocationID: int64</span></span>
<span><span class="co">#&gt; DOLocationID: int64</span></span>
<span><span class="co">#&gt; trip_miles: double</span></span>
<span><span class="co">#&gt; trip_time: int64</span></span>
<span><span class="co">#&gt; base_passenger_fare: double</span></span>
<span><span class="co">#&gt; tolls: double</span></span>
<span><span class="co">#&gt; bcf: double</span></span>
<span><span class="co">#&gt; sales_tax: double</span></span>
<span><span class="co">#&gt; congestion_surcharge: double</span></span>
<span><span class="co">#&gt; airport_fee: double</span></span>
<span><span class="co">#&gt; tips: double</span></span>
<span><span class="co">#&gt; driver_pay: double</span></span>
<span><span class="co">#&gt; shared_request_flag: string</span></span>
<span><span class="co">#&gt; shared_match_flag: string</span></span>
<span><span class="co">#&gt; access_a_ride_flag: string</span></span>
<span><span class="co">#&gt; wav_request_flag: string</span></span>
<span><span class="co">#&gt; wav_match_flag: string</span></span>
<span><span class="co">#&gt; month: int32</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See $metadata for additional Schema metadata</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Importing the zone code description.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ZoneCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"raw-data/taxi_zone_lookup.csv"</span><span class="op">)</span>,</span>
<span>  colClasses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"integer"</span>,</span>
<span>                 <span class="st">"character"</span>,</span>
<span>                 <span class="st">"character"</span>,</span>
<span>                 <span class="st">"character"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">ZoneCodes</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 265</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ LocationID   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17â€¦</span></span>
<span><span class="co">#&gt; $ Borough      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "EWR", "Queens", "Bronx", "Manhattan", "Staten Island", "â€¦</span></span>
<span><span class="co">#&gt; $ Zone         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Newark Airport", "Jamaica Bay", "Allerton/Pelham Gardensâ€¦</span></span>
<span><span class="co">#&gt; $ service_zone <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "EWR", "Boro Zone", "Boro Zone", "Yellow Zone", "Boro Zonâ€¦</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Counting the number of trips for each code, collecting and
translating the zone codes.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TripsZoneDistribution</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">PULocationID</span>, <span class="va">DOLocationID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/join_zones.html">join_zones</a></span><span class="op">(</span>zone_tb <span class="op">=</span> <span class="va">ZoneCodes</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">TripsZoneDistribution</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 65,445</span></span>
<span><span class="co">#&gt; Columns: 9</span></span>
<span><span class="co">#&gt; $ start_borough      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Queens", "Brooklyn", "Queens", "Brooklyn", "Brooklâ€¦</span></span>
<span><span class="co">#&gt; $ start_zone         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "JFK Airport", "East New York", "LaGuardia Airport"â€¦</span></span>
<span><span class="co">#&gt; $ start_service_zone <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Airports", "Boro Zone", "Airports", "Boro Zone", "â€¦</span></span>
<span><span class="co">#&gt; $ end_borough        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Unknown", "Brooklyn", "Unknown", "Brooklyn", "Brooâ€¦</span></span>
<span><span class="co">#&gt; $ end_zone           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "NA", "East New York", "NA", "Borough Park", "Canarâ€¦</span></span>
<span><span class="co">#&gt; $ end_service_zone   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "N/A", "Boro Zone", "N/A", "Boro Zone", "Boro Zone"â€¦</span></span>
<span><span class="co">#&gt; $ n                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 690618, 640891, 453413, 383687, 368971, 324967, 272â€¦</span></span>
<span><span class="co">#&gt; $ pct                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.003, 0.003, 0.002, 0.002, 0.002, 0.002, 0.001, 0.â€¦</span></span>
<span><span class="co">#&gt; $ pct_cumulative     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.003, 0.006, 0.008, 0.010, 0.012, 0.014, 0.015, 0.â€¦</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="individual-distributions">Individual distributions<a class="anchor" aria-label="anchor" href="#individual-distributions"></a>
</h2>
<div class="section level3">
<h3 id="categorical-variables">Categorical variables<a class="anchor" aria-label="anchor" href="#categorical-variables"></a>
</h3>
<p>Letâ€™s starting counting and checking the proportions related to each
category.</p>
<div class="section level4">
<h4 id="company">company<a class="anchor" aria-label="anchor" href="#company"></a>
</h4>
<p>The majority number of trips are done by <em>Uber</em> (HV003) and
the rest for <em>Lyft</em>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span>company <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">hvfhs_license_num</span> <span class="op">==</span> <span class="st">"HV0002"</span> <span class="op">~</span> <span class="st">"Juno"</span>,</span>
<span>                                <span class="va">hvfhs_license_num</span> <span class="op">==</span> <span class="st">"HV0003"</span> <span class="op">~</span> <span class="st">"Uber"</span>,</span>
<span>                                <span class="va">hvfhs_license_num</span> <span class="op">==</span> <span class="st">"HV0004"</span> <span class="op">~</span> <span class="st">"Via"</span>,</span>
<span>                                <span class="va">hvfhs_license_num</span> <span class="op">==</span> <span class="st">"HV0005"</span> <span class="op">~</span> <span class="st">"Lyft"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    company         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;     &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    Uber 153847310 0.724          0.724</span></span>
<span><span class="co">#&gt; 2:    Lyft  58568773 0.276          1.000</span></span></code></pre></div>
<blockquote>
<p>To improve interpretavility we need to make the same translation
after sampling the data.</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="dispatching_base_num">dispatching_base_num<a class="anchor" aria-label="anchor" href="#dispatching_base_num"></a>
</h4>
<p>For most of the trips the dispatching number are
<strong>B03404</strong> and <strong>B03406</strong>. The remaining codes
represent a small proportion of observations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">dispatching_base_num</span><span class="op">)</span></span>
<span><span class="co">#&gt;     dispatching_base_num         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;                   &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:               B03404 153732577 0.724          0.724</span></span>
<span><span class="co">#&gt;  2:               B03406  58568773 0.276          1.000</span></span>
<span><span class="co">#&gt;  3:               B02764     54512 0.000          1.000</span></span>
<span><span class="co">#&gt;  4:               B02872      6078 0.000          1.000</span></span>
<span><span class="co">#&gt;  5:               B02395      4789 0.000          1.000</span></span>
<span><span class="co">#&gt; ---                                                    </span></span>
<span><span class="co">#&gt; 25:               B02878       591 0.000          1.000</span></span>
<span><span class="co">#&gt; 26:               B02879       458 0.000          1.000</span></span>
<span><span class="co">#&gt; 27:               B02875       213 0.000          1.000</span></span>
<span><span class="co">#&gt; 28:               B02883       137 0.000          1.000</span></span>
<span><span class="co">#&gt; 29:               B02865         3 0.000          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="originating_base_num">originating_base_num<a class="anchor" aria-label="anchor" href="#originating_base_num"></a>
</h4>
<p>For most of the trips the originating number is
<strong>B03404</strong> and the second is missing. The remaining codes
represent a small proportion of observations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">originating_base_num</span><span class="op">)</span></span>
<span><span class="co">#&gt;     originating_base_num         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;                   &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:               B03404 153730161 0.724          0.724</span></span>
<span><span class="co">#&gt;  2:                 &lt;NA&gt;  58498724 0.275          0.999</span></span>
<span><span class="co">#&gt;  3:               B03406     71481 0.000          0.999</span></span>
<span><span class="co">#&gt;  4:               B02764     54511 0.000          0.999</span></span>
<span><span class="co">#&gt;  5:               B02872      6078 0.000          0.999</span></span>
<span><span class="co">#&gt; ---                                                    </span></span>
<span><span class="co">#&gt; 33:               B02003        10 0.000          0.999</span></span>
<span><span class="co">#&gt; 34:               B00446         6 0.000          0.999</span></span>
<span><span class="co">#&gt; 35:               B01985         5 0.000          0.999</span></span>
<span><span class="co">#&gt; 36:               B02865         3 0.000          0.999</span></span>
<span><span class="co">#&gt; 37:               B02826         1 0.000          0.999</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="access_a_ride_flag">access_a_ride_flag<a class="anchor" aria-label="anchor" href="#access_a_ride_flag"></a>
</h4>
<p>Must of the trips doesnâ€™t provide any information related to whether
they were administered on behalf of the Metropolitan Transportation
Authority (MTA) and the remaining confirm that there arenâ€™t.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">access_a_ride_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt;    access_a_ride_flag         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;                &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                    153847310 0.724          0.724</span></span>
<span><span class="co">#&gt; 2:                  N  58568773 0.276          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="shared_request_flag">shared_request_flag<a class="anchor" aria-label="anchor" href="#shared_request_flag"></a>
</h4>
<p>Most of passengers <strong>donâ€™t request</strong> to a shared/pooled
ride.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">shared_request_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt;    shared_request_flag         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                   N 210564721 0.991          0.991</span></span>
<span><span class="co">#&gt; 2:                   Y   1851362 0.009          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="shared_match_flag">shared_match_flag<a class="anchor" aria-label="anchor" href="#shared_match_flag"></a>
</h4>
<p>Most of passengers donâ€™t request to a shared/pooled ride, but even
<strong>fewer achieved to share the ride</strong>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">shared_match_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt;    shared_match_flag         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;               &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                 N 211916075 0.998          0.998</span></span>
<span><span class="co">#&gt; 2:                 Y    500008 0.002          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="wav_request_flag">wav_request_flag<a class="anchor" aria-label="anchor" href="#wav_request_flag"></a>
</h4>
<p>Itâ€™s really <strong>unusual to request a
wheelchair-accessible</strong> vehicle.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">wav_request_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wav_request_flag         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;              &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                N 212142808 0.999          0.999</span></span>
<span><span class="co">#&gt; 2:                Y    273275 0.001          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="wav_match_flag">wav_match_flag<a class="anchor" aria-label="anchor" href="#wav_match_flag"></a>
</h4>
<p>Itâ€™s really unusual to request a wheelchair-accessible vehicle, but
we have more tips take place in wheelchair-accessible vehicles, so
<strong>it seems that the service has the capacity to meet the
demand</strong>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">wav_match_flag</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wav_match_flag         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;            &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:              N 199779404 0.941          0.941</span></span>
<span><span class="co">#&gt; 2:              Y  12636679 0.059          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="start_borough">start_borough<a class="anchor" aria-label="anchor" href="#start_borough"></a>
</h4>
<p><strong>87% of trips</strong> start in <em>Manhattan</em>,
<em>Brooklyn</em> or <em>Queens</em>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TripsZoneDistribution</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">start_borough</span>, wt <span class="op">=</span>  <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;    start_borough        n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;           &lt;char&gt;    &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     Manhattan 88031630 0.414          0.414</span></span>
<span><span class="co">#&gt; 2:      Brooklyn 54874948 0.258          0.672</span></span>
<span><span class="co">#&gt; 3:        Queens 41897696 0.197          0.869</span></span>
<span><span class="co">#&gt; 4:         Bronx 24797734 0.117          0.986</span></span>
<span><span class="co">#&gt; 5: Staten Island  2803425 0.013          0.999</span></span>
<span><span class="co">#&gt; 6:       Unknown    10625 0.000          0.999</span></span>
<span><span class="co">#&gt; 7:           EWR       25 0.000          0.999</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="end_borough">end_borough<a class="anchor" aria-label="anchor" href="#end_borough"></a>
</h4>
<p><strong>82% of trips</strong> end in <em>Manhattan</em>,
<em>Brooklyn</em> or <em>Queens</em>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TripsZoneDistribution</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">end_borough</span>, wt <span class="op">=</span>  <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;      end_borough        n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;           &lt;char&gt;    &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     Manhattan 80967388 0.381          0.381</span></span>
<span><span class="co">#&gt; 2:      Brooklyn 54143716 0.255          0.636</span></span>
<span><span class="co">#&gt; 3:        Queens 40982171 0.193          0.829</span></span>
<span><span class="co">#&gt; 4:         Bronx 23541369 0.111          0.940</span></span>
<span><span class="co">#&gt; 5:       Unknown  8659223 0.041          0.981</span></span>
<span><span class="co">#&gt; 6: Staten Island  2755107 0.013          0.994</span></span>
<span><span class="co">#&gt; 7:           EWR  1367109 0.006          1.000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="start_service_zone">start_service_zone<a class="anchor" aria-label="anchor" href="#start_service_zone"></a>
</h4>
<p><strong>96% of trips</strong> start in <em>Boro Zone</em> and
<em>Yellow Zone</em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TripsZoneDistribution</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">start_service_zone</span>, wt <span class="op">=</span>  <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;    start_service_zone         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;                &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          Boro Zone 129107636 0.608          0.608</span></span>
<span><span class="co">#&gt; 2:        Yellow Zone  75817668 0.357          0.965</span></span>
<span><span class="co">#&gt; 3:           Airports   7480129 0.035          1.000</span></span>
<span><span class="co">#&gt; 4:                N/A     10625 0.000          1.000</span></span>
<span><span class="co">#&gt; 5:                EWR        25 0.000          1.000</span></span></code></pre></div>
<blockquote>
<p>We need to recode EWR are Airports to keep the classification
consistent.</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="end_service_zone">end_service_zone<a class="anchor" aria-label="anchor" href="#end_service_zone"></a>
</h4>
<p><strong>91% of trips</strong> start in <em>Boro Zone</em> and
<em>Yellow Zone</em>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TripsZoneDistribution</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span><span class="va">end_service_zone</span>, wt <span class="op">=</span>  <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;    end_service_zone         n   pct pct_cumulative</span></span>
<span><span class="co">#&gt;              &lt;char&gt;     &lt;int&gt; &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Boro Zone 124765613 0.587          0.587</span></span>
<span><span class="co">#&gt; 2:      Yellow Zone  69100865 0.325          0.912</span></span>
<span><span class="co">#&gt; 3:              N/A   8659223 0.041          0.953</span></span>
<span><span class="co">#&gt; 4:         Airports   8523273 0.040          0.993</span></span>
<span><span class="co">#&gt; 5:              EWR   1367109 0.006          0.999</span></span></code></pre></div>
<blockquote>
<p>We need to recode EWR are Airports to keep the classification
consistent.</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="start_service-vs-end_service-zones">start_service vs end_service zones<a class="anchor" aria-label="anchor" href="#start_service-vs-end_service-zones"></a>
</h4>
<ul>
<li>
<p><code>start_zone</code> and <code>end_zone</code>: As our data
has 55,559 rows of relations between both columns, we opted to transform
data in a way what each unique zone represent a row reducing the points
to be plotted to only 238 by following the next steps:</p>
<ol style="list-style-type: decimal">
<li>Summarizing the total number of trips for each <strong>starting
point</strong> independently to its destination</li>
<li>Summarizing the total number of trips for each <strong>ending
point</strong> independently to its origin.</li>
<li>Joining both tables into one.</li>
</ol>
</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Summarizing Staring Zones</span></span>
<span><span class="va">StartingZonesCount</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">TripsZoneDistribution</span><span class="op">[</span></span>
<span>    <span class="op">!</span><span class="va">start_borough</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/chmatch.html" class="external-link">%chin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Staten Island"</span>, <span class="st">"Unknown"</span>, <span class="st">"EWR"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="op">!</span><span class="va">end_borough</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/chmatch.html" class="external-link">%chin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Staten Island"</span>, <span class="st">"Unknown"</span>, <span class="st">"EWR"</span><span class="op">)</span>,</span>
<span>    <span class="fu">.</span><span class="op">(</span>start_trips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span>  <span class="fu">.</span><span class="op">(</span>borough <span class="op">=</span> <span class="va">start_borough</span>, </span>
<span>            zone <span class="op">=</span> <span class="va">start_zone</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span></span>
<span><span class="co"># 2. Summarizing Ending Zones</span></span>
<span><span class="va">EndingZonesCount</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">TripsZoneDistribution</span><span class="op">[</span></span>
<span>    <span class="op">!</span><span class="va">start_borough</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/chmatch.html" class="external-link">%chin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Staten Island"</span>, <span class="st">"Unknown"</span>, <span class="st">"EWR"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="op">!</span><span class="va">end_borough</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/chmatch.html" class="external-link">%chin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Staten Island"</span>, <span class="st">"Unknown"</span>, <span class="st">"EWR"</span><span class="op">)</span>, </span>
<span>    <span class="fu">.</span><span class="op">(</span>end_trips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span>  <span class="fu">.</span><span class="op">(</span>borough <span class="op">=</span> <span class="va">end_borough</span>, </span>
<span>            zone <span class="op">=</span> <span class="va">end_zone</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span></span>
<span><span class="co"># 3. Inner Joining Starting and Ending Zones Counts</span></span>
<span><span class="va">JoinedZonesCount</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">StartingZonesCount</span><span class="op">[</span></span>
<span>    <span class="va">EndingZonesCount</span>,</span>
<span>    on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"borough"</span>, <span class="st">"zone"</span><span class="op">)</span>,</span>
<span>    nomatch <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">]</span></span></code></pre></div>
<p>Once we have a much simpler data to work with, we is easy to confirm
with the next linear regression that <code>start_trips</code> and
<code>end_trips</code> has almost the same values the model has an slope
of one. That means that in must of cases <strong>if someone takes a taxi
to go to any place itâ€™s really likely to take another taxi
back</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">end_trips</span> <span class="op">~</span> <span class="va">start_trips</span>, </span>
<span>   data <span class="op">=</span> <span class="va">JoinedZonesCount</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = end_trips ~ start_trips, data = JoinedZonesCount)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -428723  -34008    9811   26938 1315702 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -2.274e+04  1.321e+04  -1.722   0.0864 .  </span></span>
<span><span class="co">#&gt; start_trips  1.027e+00  1.231e-02  83.465   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 127400 on 236 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9672, Adjusted R-squared:  0.9671 </span></span>
<span><span class="co">#&gt; F-statistic:  6966 on 1 and 236 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Letâ€™s now explore the zones where there is <strong>no
balance</strong> between the <code>start_trips</code> and the
<code>end_trips</code> in the most visited zoned of each Borough. To do
so, we defined the rate <code>end_trips</code>/<code>start_trips</code>
and highlight zones with lower rate than the 15% percentile or higher
rate than 85% percentile.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating dataset to plot</span></span>
<span><span class="va">ZonesCountToPlot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">JoinedZonesCount</span><span class="op">)</span><span class="op">[</span></span>
<span>    j <span class="op">=</span> <span class="fu">`:=`</span><span class="op">(</span>ending_starting_rate <span class="op">=</span> <span class="va">end_trips</span><span class="op">/</span><span class="va">start_trips</span>,</span>
<span>             borough <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">borough</span>, <span class="op">-</span><span class="va">end_trips</span>, .fun <span class="op">=</span> <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             end_m_trips <span class="op">=</span> <span class="va">end_trips</span> <span class="op">/</span> <span class="fl">1e6L</span>,</span>
<span>             start_m_trips <span class="op">=</span> <span class="va">start_trips</span> <span class="op">/</span> <span class="fl">1e6L</span><span class="op">)</span></span>
<span>  <span class="op">]</span><span class="op">[</span>, <span class="va">unbalance_situation</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span></span>
<span>    <span class="va">ending_starting_rate</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ending_starting_rate</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>    <span class="st">"More starts than ends"</span>,</span>
<span>    <span class="va">ending_starting_rate</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ending_starting_rate</span>, <span class="fl">0.85</span><span class="op">)</span>,</span>
<span>    <span class="st">"More ends than starts"</span>,</span>
<span>    default <span class="op">=</span> <span class="st">"Balanced"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">start_trips</span> <span class="op">+</span> <span class="va">end_trips</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"borough"</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># Creating the scatted plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ZonesCountToPlot</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">start_m_trips</span>, <span class="va">end_m_trips</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html" class="external-link">geom_blank</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">start_m_trips</span>, <span class="va">end_m_trips</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">start_m_trips</span>, <span class="va">end_m_trips</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">borough</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ZonesCountToPlot</span><span class="op">[</span><span class="va">unbalance_situation</span> <span class="op">==</span></span>
<span>                                      <span class="st">"More starts than ends"</span><span class="op">]</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">zone</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>            hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.12</span>,</span>
<span>            check_overlap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ZonesCountToPlot</span><span class="op">[</span><span class="va">unbalance_situation</span> <span class="op">==</span></span>
<span>                                      <span class="st">"More ends than starts"</span><span class="op">]</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">zone</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">1.12</span>,</span>
<span>            check_overlap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, suffix <span class="op">=</span> <span class="st">" M"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, suffix <span class="op">=</span> <span class="st">" M"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Top 6 Most Important Zones by Borough"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Borough"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of Trips Starting"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Trips Ending"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Based on the results, we can highlight the next points:</p>
<ol style="list-style-type: decimal">
<li><p>The airports present in Queens, <em>LaGuardia Airport</em> and
<em>JFK Airport</em>, have many more trips going to the airport than
going out of airport. This might happen due that there are more
transportation options like other taxis, shuttles, and public
transportation.</p></li>
<li><p>The remaining zones, <em>Jackson Heights</em>, <em>East
Village</em> and <em>TriBeCa/Civic Center</em>, are residential zones
with a variety of public transportation options.</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="time-variables">Time variables<a class="anchor" aria-label="anchor" href="#time-variables"></a>
</h3>
<p>As we want to predict the <strong>profit rate</strong> related to
each trip, we just need to consider for this analysis
<code>request_datetime</code> as is the only variable available to the
driver before starting a trip and the <code>dropoff_datetime</code> the
point used to defining the end of a trip.</p>
<p>We know that a taxi trip takes more less than a day doesnâ€™t make more
sense to explore each variable related to time. Instead, it is better to
consecrate the efforts to understand the distribution of the exploratory
variable later to explore the difference between
<code>request_datetime</code> and <code>dropoff_datetime</code> as a
<strong>numeric variable</strong>.</p>
<p>To describe this variable, we decomposed it in different parts and
count the number trips by each element and store the summary as a
<code>data.table</code> to explore each part using visualizations.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>request_date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="va">request_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span>request_month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">request_date</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span>,</span>
<span>        request_week <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">request_date</span>, unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>        request_day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">request_date</span><span class="op">)</span>,</span>
<span>        request_weekday <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">request_date</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        request_hour <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">hour</a></span><span class="op">(</span><span class="va">request_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="request_datetime-by-month">request_datetime by month<a class="anchor" aria-label="anchor" href="#request_datetime-by-month"></a>
</h4>
<p>In the next chart, we can see that the number trips keeps almost
constant must of the year, but we have some fewer trips during the first
2 months and some extra trips in October and December.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span><span class="op">[</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">request_month</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2022</span>, </span>
<span>                   <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="st">"request_month"</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">request_month</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dodgerblue4"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%y-%m"</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"2 months"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">2e6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Trips by Month"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Trips Request Month"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Trips"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="request_datetime-by-week">request_datetime by week<a class="anchor" aria-label="anchor" href="#request_datetime-by-week"></a>
</h4>
<p>By breaking the months into weeks we can confirm we have fewer trips
in the first 2 months, in relation to October we donâ€™t see a big change
in he number of trips we see is that it has more weeks than November,
but December keeps having more trips than normal in the first 2
weeks.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span><span class="op">[</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">request_month</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2022</span>, </span>
<span>                   <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="st">"request_week"</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">request_week</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dodgerblue4"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%y-%m"</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">5e5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Trips by Week"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Trips Request Week"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Trips"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="request_datetime-by-month-day">request_datetime by month day<a class="anchor" aria-label="anchor" href="#request_datetime-by-month-day"></a>
</h4>
<p>If we explore the number of trips by month day we can not see any
consistent pattern after plotting a line with total of trips for each
month.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span><span class="op">[</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">request_month</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2022</span>, </span>
<span>                   <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>request_month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">request_month</span>, <span class="st">"%B"</span><span class="op">)</span>,</span>
<span>                          <span class="va">request_day</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">request_day</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">request_month</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"gray60"</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'loess'</span>,</span>
<span>              formula <span class="op">=</span> <span class="st">'y ~ x'</span>,</span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of Trips by Month Day"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Trips"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Day of Month"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="request_datetime-by-week-day">request_datetime by week day<a class="anchor" aria-label="anchor" href="#request_datetime-by-week-day"></a>
</h4>
<p>By if we change the month day in the prior chart with week day we can
find that the number of trips trends to be higher Fridays and
Saturdays.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span><span class="op">[</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">request_month</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2022</span>, </span>
<span>                   <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>request_month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">request_month</span>, <span class="st">"%B"</span><span class="op">)</span>,</span>
<span>                          <span class="va">request_weekday</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">request_weekday</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">request_month</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"gray60"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'loess'</span>,</span>
<span>              formula <span class="op">=</span> <span class="st">'y ~ x'</span>,</span>
<span>              se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_width.html" class="external-link">breaks_width</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="va">factor_weekday</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of Trips by Week Day"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of Trips"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Day of Week"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="request_datetime-by-week-day-and-hour">request_datetime by week day and hour<a class="anchor" aria-label="anchor" href="#request_datetime-by-week-day-and-hour"></a>
</h4>
<p>To understand better what is happening Fridays and Saturdays letâ€™s
break each week day by hour. In the next chart, we can see how the
higher number of trips start at 17:00 and end at 1:00 of next day for
Fridays and Saturdays.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RequestTimeSummary</span><span class="op">[</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">request_month</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2022</span>, </span>
<span>                   <span class="fu">.</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span>request_hour <span class="op">=</span> </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">request_hour</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                          request_weekday <span class="op">=</span> <span class="fu"><a href="../reference/factor_weekday.html">factor_weekday</a></span><span class="op">(</span><span class="va">request_weekday</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">]</span><span class="op">[</span>, <span class="va">n_million</span> <span class="op">:=</span> <span class="va">n</span><span class="op">/</span><span class="fl">1e6</span> <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">request_weekday</span>, <span class="va">request_hour</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">0.005</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n_million</span>, accuracy <span class="op">=</span> <span class="fl">0.1</span>, suffix <span class="op">=</span> <span class="st">" M"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                      high <span class="op">=</span> <span class="st">"dodgerblue4"</span>,</span>
<span>                      labels<span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of Trips by Hour and Week Day"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Number of Trips"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Request Week Day"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Request Hour"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="03-data-understanding_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="numeric-variables">Numeric variables<a class="anchor" aria-label="anchor" href="#numeric-variables"></a>
</h3>
<p>Last but not least, it time check explore the individual distribution
of numeric variable based of summary metrics by using the custom
<code>compute_num_summary</code> to use all the power under the
<code>arrow</code> package.</p>
<div class="section level4">
<h4 id="trip_miles">trip_miles<a class="anchor" aria-label="anchor" href="#trip_miles"></a>
</h4>
<p>Below we can see that the min distance was <strong>0 miles</strong>
which can be possible if the trip duration was also short, but we need
to check those cases and the higher distance was <strong>634
miles</strong>, which can be a valid outlier taking in consideration
that the higher whisker is 13.2 miles.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_num_summary.html">compute_num_summary</a></span><span class="op">(</span><span class="va">trip_miles</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: quantile() currently returns an approximate quantile in Arrow</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">#&gt; Warning: median() currently returns an approximate median in Arrow</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 9</span></span></span>
<span><span class="co">#&gt;      sd min_value lower_whisker    q1    q2  mean    q3 higher_whisker max_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  5.87         0         -<span style="color: #BB0000;">5.35</span>  1.61  3.02  5.03  6.25           13.2      634.</span></span></code></pre></div>
<p>We can also check that only 24.4K trips are over 100 miles.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span>trip_miles_status <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">trip_miles</span> <span class="op">&lt;</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"Normal trips"</span>,</span>
<span>                                          <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"Long Trips"</span><span class="op">)</span>,</span>
<span>            digits <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span>
<span><span class="co">#&gt;    trip_miles_status         n    pct pct_cumulative</span></span>
<span><span class="co">#&gt;               &lt;char&gt;     &lt;int&gt;  &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      Normal trips 212391618 0.9999         0.9999</span></span>
<span><span class="co">#&gt; 2:        Long Trips     24465 0.0001         1.0000</span></span></code></pre></div>
<p>But even just taking the long trips we can see that 90% of those
trips were shorter than <strong>300 miles</strong>, those trips doesnâ€™t
look like good examples to train the model.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span>miles_interval <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">600</span> <span class="op">~</span> <span class="st">"&gt;=600"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">500</span> <span class="op">~</span> <span class="st">"[500, 600)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">400</span> <span class="op">~</span> <span class="st">"[400, 500)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">300</span> <span class="op">~</span> <span class="st">"[300, 400)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"[200, 300)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">150</span> <span class="op">~</span> <span class="st">"[150, 200)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">130</span> <span class="op">~</span> <span class="st">"[130, 150)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">115</span> <span class="op">~</span> <span class="st">"[115, 130)"</span>,</span>
<span>                                       <span class="va">trip_miles</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"[100,115)"</span><span class="op">)</span>,</span>
<span>            digits <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span>
<span><span class="co">#&gt;    miles_interval     n    pct pct_cumulative</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;int&gt;  &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      [100,115) 11735 0.4797         0.4797</span></span>
<span><span class="co">#&gt; 2:     [115, 130)  5292 0.2163         0.6960</span></span>
<span><span class="co">#&gt; 3:     [130, 150)  2802 0.1145         0.8105</span></span>
<span><span class="co">#&gt; 4:     [150, 200)  2370 0.0969         0.9074</span></span>
<span><span class="co">#&gt; 5:     [200, 300)  1675 0.0685         0.9759</span></span>
<span><span class="co">#&gt; 6:     [300, 400)   248 0.0101         0.9860</span></span>
<span><span class="co">#&gt; 7:     [400, 500)   233 0.0095         0.9955</span></span>
<span><span class="co">#&gt; 8:     [500, 600)    95 0.0039         0.9994</span></span>
<span><span class="co">#&gt; 9:          &gt;=600    15 0.0006         1.0000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="base_passenger_fare">base_passenger_fare<a class="anchor" aria-label="anchor" href="#base_passenger_fare"></a>
</h4>
<p>Having a negative number as base fare doesnâ€™t have any sense, so any
negative number needs more investigation. On the other side we all also
can see a <strong>5k trip</strong> which doesnâ€™t make sense as well.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_num_summary.html">compute_num_summary</a></span><span class="op">(</span><span class="va">base_passenger_fare</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 9</span></span></span>
<span><span class="co">#&gt;      sd min_value lower_whisker    q1    q2  mean    q3 higher_whisker max_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  19.7     -<span style="color: #BB0000;">520.</span>         -<span style="color: #BB0000;">15.0</span>  11.4  18.2  23.7  29.1           55.5     <span style="text-decoration: underline;">4</span>996.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tips">tips<a class="anchor" aria-label="anchor" href="#tips"></a>
</h4>
<p>The column looks really good, it makes sense that for more than 75%
of trips the tip is 0 as it is not mandatory, but having a trip with a
$294 tip is not hard to believe.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_num_summary.html">compute_num_summary</a></span><span class="op">(</span><span class="va">tips</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 9</span></span></span>
<span><span class="co">#&gt;      sd min_value lower_whisker    q1    q2  mean    q3 higher_whisker max_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  3.04         0             0     0     0  1.08     0              0      294.</span></span></code></pre></div>
<p>After braking the <code>tips</code> we can see that <code>80%</code>
of trips donâ€™t present any tip and must of the tips are lower than
<strong>50 dollars</strong>, so gets really hard to achieved more than
that based on tips.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span>tips_interval <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">tips</span> <span class="op">&gt;=</span> <span class="fl">250</span> <span class="op">~</span> <span class="st">"&gt;=250"</span>,</span>
<span>                                      <span class="va">tips</span> <span class="op">&gt;=</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"[200, 250)"</span>,</span>
<span>                                      <span class="va">tips</span> <span class="op">&gt;=</span> <span class="fl">150</span> <span class="op">~</span> <span class="st">"[150, 200)"</span>,</span>
<span>                                      <span class="va">tips</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"[100, 150)"</span>,</span>
<span>                                      <span class="va">tips</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"[50, 100)"</span>,</span>
<span>                                      <span class="va">tips</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"(0, 50)"</span>,</span>
<span>                                      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"0"</span><span class="op">)</span>,</span>
<span>            digits <span class="op">=</span> <span class="fl">8L</span><span class="op">)</span></span>
<span><span class="co">#&gt;    tips_interval         n        pct pct_cumulative</span></span>
<span><span class="co">#&gt;           &lt;char&gt;     &lt;int&gt;      &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:             0 170057940 0.80058881      0.8005888</span></span>
<span><span class="co">#&gt; 2:       (0, 50)  42325635 0.19925815      0.9998470</span></span>
<span><span class="co">#&gt; 3:     [50, 100)     31872 0.00015005      0.9999970</span></span>
<span><span class="co">#&gt; 4:    [100, 150)       572 0.00000269      0.9999997</span></span>
<span><span class="co">#&gt; 5:    [150, 200)        56 0.00000026      1.0000000</span></span>
<span><span class="co">#&gt; 6:    [200, 250)         7 0.00000003      1.0000000</span></span>
<span><span class="co">#&gt; 7:         &gt;=250         1 0.00000000      1.0000000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="trip_minutes">trip_minutes<a class="anchor" aria-label="anchor" href="#trip_minutes"></a>
</h4>
<p>After taking the difference in minutes between the request time and
the drop off time in minutes, we can see negative trips and some other
much longer than an hour.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trip_minutes <span class="op">=</span> <span class="fu">arrow_minutes_between</span><span class="op">(</span><span class="va">request_datetime</span>, <span class="va">dropoff_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_num_summary.html">compute_num_summary</a></span><span class="op">(</span><span class="va">trip_minutes</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 9</span></span></span>
<span><span class="co">#&gt;      sd min_value lower_whisker    q1    q2  mean    q3 higher_whisker max_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  14.7      -<span style="color: #BB0000;">314</span>         -<span style="color: #BB0000;">9.28</span>  14.6  21.0  24.6  30.5           54.4      <span style="text-decoration: underline;">2</span>469</span></span></code></pre></div>
<p>Now we can see that 99% of trips takes less than 2 hours and only
152,049 trips have more than 2 hour trip.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NycTrips2022</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trip_minutes <span class="op">=</span> <span class="fu">arrow_minutes_between</span><span class="op">(</span><span class="va">request_datetime</span>, <span class="va">dropoff_datetime</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/count_pct.html">count_pct</a></span><span class="op">(</span>trip_minutes_status <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">trip_minutes</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"Negative"</span>,</span>
<span>                                            <span class="va">trip_minutes</span> <span class="op">&lt;=</span> <span class="fl">60</span>   <span class="op">~</span> <span class="st">"1 hour or less"</span>,</span>
<span>                                            <span class="va">trip_minutes</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(1:00, 2:00]"</span>,</span>
<span>                                            <span class="va">trip_minutes</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="st">"(2:00, 3:00]"</span>,</span>
<span>                                            <span class="va">trip_minutes</span> <span class="op">&gt;</span> <span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="st">"&gt;3 hours"</span><span class="op">)</span>,</span>
<span>            digits <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span></span>
<span><span class="co">#&gt;    trip_minutes_status         n      pct pct_cumulative</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;     &lt;int&gt;    &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1 hour or less 206298571 0.971200       0.971200</span></span>
<span><span class="co">#&gt; 2:        (1:00, 2:00]   5740869 0.027027       0.998227</span></span>
<span><span class="co">#&gt; 3:            Negative    224594 0.001057       0.999284</span></span>
<span><span class="co">#&gt; 4:        (2:00, 3:00]    132341 0.000623       0.999907</span></span>
<span><span class="co">#&gt; 5:            &gt;3 hours     19708 0.000093       1.000000</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sampling-data">Sampling data<a class="anchor" aria-label="anchor" href="#sampling-data"></a>
</h2>
<p>Due our limited compute power capacity we will need to down sample
the data to be able to unlock all R capacities.</p>
<p>As most of the trips take place between Manhattan, Brooklyn and
Queens, we are going to focus first in those zones.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BoroughToKeep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Manhattan"</span>, <span class="st">"Brooklyn"</span>, <span class="st">"Queens"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TrainingTrips</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">data_path</span>,</span>
<span>      full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sample_parquet</span>,</span>
<span>         valid_zones <span class="op">=</span> <span class="va">ZoneCodes</span><span class="op">[</span><span class="va">Borough</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/chmatch.html" class="external-link">%chin%</a></span> <span class="va">BoroughToKeep</span>, <span class="va">LocationID</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="solving-quality-problems">Solving quality problems<a class="anchor" aria-label="anchor" href="#solving-quality-problems"></a>
</h2>
</div>
<div class="section level2">
<h2 id="correlations-between-predictors-and-target-variable">Correlations between predictors and target variable<a class="anchor" aria-label="anchor" href="#correlations-between-predictors-and-target-variable"></a>
</h2>
<p>Before exploring correlations we need to transforming the sampled
data by:</p>
<ul>
<li>Solving quality problems.</li>
<li>Transforming categorical variables into boolean ones.</li>
<li>Transforming zone code to factors.</li>
<li>Adding new features.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://angelfeliz.com" class="external-link">Angel Feliz</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

---
title: "Simulate Trips"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
```

## simulate_without_strategy

```{r function-simulate_without_strategy}

simulate_without_strategy <- function(dt,
                                      conn) {
  
}
```

### examples

```{r examples-simulate_without_strategy}

con <- DBI::dbConnect(duckdb::duckdb(), dbdir = "my-db.duckdb")

on.exit({
  DBI::dbDisconnect(conn = con)
  rm(con)
  unlink("my-db.duckdb")
})

# Defining some zone context
valid_zones <- 1:3
closest_zones <- c(2L, 1L, 2L)
names(closest_zones) <- valid_zones
borough_zones <- data.frame(
  LocationID = valid_zones,
  id_list = I(list(valid_zones, valid_zones, valid_zones))
)

# Defining start point
start_datetime <- lubridate::make_datetime(2023L, 5L, 18L, 8L)
start_zone <- 1L

# Let's check trips from at 3 levels
# 1. Starting in the same zone
# 2. Starting in the closest zone
# 3. Starting in the farthest zone
valid_trips <- data.frame(
  year = 2023L,
  month = 5L,
  PULocationID = c(1L, 2L, 3L),
  DOLocationID = c(3L, 1L, 1L),
  request_datetime = c(
   start_datetime + lubridate::minutes(2L),
   start_datetime + lubridate::minutes(20L + 7L),
   start_datetime + lubridate::minutes(37L + 14L)
  ),
  dropoff_datetime = c(
   start_datetime + lubridate::minutes(20L),
   start_datetime + lubridate::minutes(37L),
   lubridate::make_datetime(2023L, 5L, 18L, 9L, 1L)
  ),
  driver_pay = 10,
  tips = 2 
)

simulate_trips(valid_trips,
               start_datetime = start_datetime,
               start_zone = start_zone,
               minutes_next_trip = 6L,
               end_datetime = start_datetime + lubridate::hours(1L),
               valid_end_zones = valid_zones,
               closest_zone = closest_zones,
               borough_zones = borough_zones)

```

### tests

```{r tests-simulate_without_strategy}

```


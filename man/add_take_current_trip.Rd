% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_take_current_trip.R
\name{add_take_current_trip}
\alias{add_take_current_trip}
\title{Add and Evaluate Future Trip Alternatives}
\usage{
add_take_current_trip(trip_sample, point_mean_distance, parquet_path)
}
\arguments{
\item{trip_sample}{A data frame containing the sample of trips to be evaluated. Each row represents a single trip.}

\item{point_mean_distance}{A data table containing mean distances between different pickup and drop-off locations.
It should include at least \code{PULocationID} and \code{DOLocationID} columns.}

\item{parquet_path}{A string specifying the path to the Parquet file containing all historical trips data, which is queried using DuckDB.}
}
\value{
A data table with the original trip sample and an additional column, \code{take_current_trip}, indicating whether the current trip should be taken (1) or not (0) based on performance metrics.
}
\description{
This function identifies and evaluates future trip alternatives for a given sample of trips.
It considers various constraints such as proximity to the current location, the time window,
and trip characteristics like wheelchair accessibility, to determine whether to take the current trip.
}
\details{
The function connects to a DuckDB database to retrieve historical trip data. For each trip in the sample, it fetches potential future trip alternatives that meet a set of criteria:
\itemize{
\item The request time must be between 3 seconds and 15 minutes after the current trip's request time.
\item Future trips must be from the same company (\code{hvfhs_license_num}) as the current trip.
\item If the current trip is not for a wheelchair-accessible vehicle, future trips must also not be for a wheelchair-accessible vehicle.
}

Each valid future trip is evaluated based on the distance from the current trip and its potential profitability,
calculated as \code{performance_per_hour} (pay per hour, adjusted for waiting time). The function then compares the performance
of each trip against the 75th percentile of performance for future trips and decides whether to take the current trip.
}
\examples{
# Example usage:
trip_sample <- data.frame(
  trip_id = 1:5,
  request_datetime = as.POSIXct(Sys.time() + c(0, 60, 120, 180, 240), origin = "1970-01-01"),
  hvfhs_license_num = sample(c('HV001', 'HV002'), 5, replace = TRUE),
  wav_match_flag = sample(c('Y', 'N'), 5, replace = TRUE),
  PULocationID = sample(1:100, 5, replace = TRUE),
  DOLocationID = sample(1:100, 5, replace = TRUE)
)

point_mean_distance <- data.table::data.table(
  PULocationID = 1:100,
  DOLocationID = 1:100,
  trip_miles_mean = runif(100)
)

parquet_path <- "path_to_parquet_file"
add_take_current_trip(trip_sample, point_mean_distance, parquet_path)

}
